<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Bus Tracking</title>

    <!-- Adicionando Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />

    <!-- CSS personalizado -->
    <link rel="stylesheet" th:href="@{/css/tracking.css}" />
</head>
<body>
<div class="container">
    <h1>Live Bus Tracking</h1>

    <div class="stats">
        <div class="stat-item">
            <div class="stat-value" id="total-buses">0</div>
            <div class="stat-label">Ônibus Em Operação</div>
        </div>
        <div class="stat-item">
            <div class="stat-value" id="visible-buses">0</div>
            <div class="stat-label">Exibindo</div>
        </div>
        <div class="stat-item">
            <div class="stat-value" id="connection-status">Desconectado</div>
            <div class="stat-label">Status Conexão</div>
        </div>
    </div>

    <div class="search-container">
        <div class="search-group">
            <label for="search-line" class="search-label">Filtrar por Linha:</label>
            <input type="text" id="search-line" class="search-input" placeholder="Ex: 123, 456, 789...">
        </div>
        <div class="search-group">
            <label for="search-order" class="search-label">Filtrar por Ordem:</label>
            <input type="text" id="search-order" class="search-input" placeholder="Ex: 1001, 1002, 1003...">
        </div>
        <button id="search-map-btn">Buscar e Mostrar Mapa</button>
    </div>

    <button id="clear-filters" class="clear-filters">Limpar Filtros</button>

    <div class="last-update" id="last-update-time"></div>

    <div class="pagination">
        <button id="prev-page">Anterior</button>
        <span id="page-info">Página 1 de 1</span>
        <button id="next-page">Próxima</button>
    </div>

    <table id="buses-table">
        <thead>
        <tr>
            <th onclick="sortTable(0)">Ordem</th>
            <th onclick="sortTable(1)">Linha</th>
            <th onclick="sortTable(2)">Latitude</th>
            <th onclick="sortTable(3)">Longitude</th>
            <th onclick="sortTable(4)">Velocidade (km/h)</th>
            <th onclick="sortTable(5)">Última Atualização</th>
        </tr>
        </thead>
        <tbody id="buses-body">
        <!-- Os dados serão inseridos aqui via JavaScript -->
        </tbody>
    </table>

    <div class="pagination">
        <button id="prev-page-bottom">Anterior</button>
        <span id="page-info-bottom">Página 1 de 1</span>
        <button id="next-page-bottom">Próxima</button>
    </div>

    <!-- Container para o mapa -->
    <div id="map-container">
        <div id="map-title">Visualização dos Ônibus no Mapa</div>

        <div class="address-search">
            <input type="text" id="search-address" placeholder="Buscar endereço (rua, avenida, bairro, cidade...)">
            <div id="autocomplete-suggestions" class="autocomplete-suggestions"></div>
            <button id="search-address-btn">Buscar Endereço</button>
        </div>

        <!-- Controles para itinerários -->
        <div class="itinerary-controls">
            <label for="itinerary-direction-select">Direção:</label>
            <select id="itinerary-direction-select" class="itinerary-select">
                <option value="0">Volta</option>
                <option value="1">Ida</option>
                <option value="both">Ambas</option>
            </select>

            <button id="show-itinerary-btn" class="itinerary-btn">Mostrar Itinerário das Linhas Filtradas</button>
            <button id="hide-itinerary-btn" class="itinerary-btn">Ocultar Itinerário</button>

            <span id="itinerary-info" class="itinerary-info"></span>
        </div>

        <div class="map-controls">
            <div class="map-buttons">
                <button id="toggle-map" class="map-toggle">Ocultar Mapa</button>
                <button id="show-all-btn" class="show-all-btn">Mostrar Todos no Mapa</button>
                <button id="toggle-cluster" class="map-toggle">Desativar Cluster</button>
            </div>
            <span id="map-buses-count" class="map-info">0 ônibus no mapa</span>
        </div>
        <div id="map"></div>
    </div>
</div>

<!-- Adicionando Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>
<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

<!-- JavaScript personalizado -->
<script th:src="@{../js/tracking.js}"></script>
</body>
</html>