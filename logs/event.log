2025-09-14 12:24:56.350 [background-preinit] INFO  [null] o.h.validator.internal.util.Version.<clinit> - HV000001: Hibernate Validator 8.0.2.Final
2025-09-14 12:24:56.415 [main] INFO  [null] c.a.m.MonitoringServiceApplication.logStarting - Starting MonitoringServiceApplication using Java 21.0.8 with PID 15064 (C:\Users\10598925708\IdeaProjects\monitoring-service\target\classes started by 10598925708 in C:\Users\10598925708\IdeaProjects\monitoring-service)
2025-09-14 12:24:56.416 [main] DEBUG [null] c.a.m.MonitoringServiceApplication.logStarting - Running with Spring Boot v3.4.2, Spring v6.2.2
2025-09-14 12:24:56.418 [main] INFO  [null] c.a.m.MonitoringServiceApplication.logStartupProfileInfo - No active profile set, falling back to 1 default profile: "default"
2025-09-14 12:24:57.870 [main] INFO  [null] o.s.b.w.e.tomcat.TomcatWebServer.initialize - Tomcat initialized with port 8080 (http)
2025-09-14 12:24:57.892 [main] INFO  [null] o.a.coyote.http11.Http11NioProtocol.log - Initializing ProtocolHandler ["http-nio-8080"]
2025-09-14 12:24:57.896 [main] INFO  [null] o.a.catalina.core.StandardService.log - Starting service [Tomcat]
2025-09-14 12:24:57.896 [main] INFO  [null] o.a.catalina.core.StandardEngine.log - Starting Servlet engine: [Apache Tomcat/10.1.34]
2025-09-14 12:24:57.970 [main] INFO  [null] o.a.c.c.C.[Tomcat].[localhost].[/].log - Initializing Spring embedded WebApplicationContext
2025-09-14 12:24:57.970 [main] INFO  [null] o.s.b.w.s.c.ServletWebServerApplicationContext.prepareWebApplicationContext - Root WebApplicationContext: initialization completed in 1490 ms
2025-09-14 12:24:58.255 [main] DEBUG [null] c.a.m.config.MdcConfig$1.init - Filter 'mdcFilter' configured for use
2025-09-14 12:24:59.383 [main] INFO  [null] o.s.b.a.e.web.EndpointLinksResolver.<init> - Exposing 3 endpoints beneath base path '/actuator'
2025-09-14 12:24:59.442 [main] INFO  [null] o.a.coyote.http11.Http11NioProtocol.log - Starting ProtocolHandler ["http-nio-8080"]
2025-09-14 12:24:59.469 [main] INFO  [null] o.s.b.w.e.tomcat.TomcatWebServer.start - Tomcat started on port 8080 (http) with context path '/'
2025-09-14 12:24:59.483 [main] INFO  [null] c.a.m.MonitoringServiceApplication.logStarted - Started MonitoringServiceApplication in 3.673 seconds (process running for 4.137)
2025-09-14 12:24:59.491 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Starting scheduled GPS polling
2025-09-14 12:24:59.493 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Fetching GPS data from 2025-09-14+12:23:29 to 2025-09-14+12:24:59
2025-09-14 12:24:59.502 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.fetchGpsData - Making request to URL: https://dados.mobilidade.rio/gps/sppo?dataInicial=2025-09-14+12:23:29&dataFinal=2025-09-14+12:24:59
2025-09-14 12:25:03.717 [http-nio-8080-exec-1] INFO  [null] o.a.c.c.C.[Tomcat].[localhost].[/].log - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-14 12:25:03.718 [http-nio-8080-exec-1] INFO  [null] o.s.web.servlet.DispatcherServlet.initServletBean - Initializing Servlet 'dispatcherServlet'
2025-09-14 12:25:03.718 [http-nio-8080-exec-1] INFO  [null] o.s.web.servlet.DispatcherServlet.initServletBean - Completed initialization in 0 ms
2025-09-14 12:25:03.777 [http-nio-8080-exec-1] INFO  [null] c.a.m.handler.GpsWebSocketHandler.afterConnectionEstablished - New client connected: df6b50ea-9ec9-cd06-ee6d-202fb9f06105
2025-09-14 12:25:05.038 [http-nio-8080-exec-3] INFO  [null] c.a.m.handler.GpsWebSocketHandler.afterConnectionClosed - Connection closed: df6b50ea-9ec9-cd06-ee6d-202fb9f06105 - Reason: null
2025-09-14 12:25:05.465 [http-nio-8080-exec-6] INFO  [null] c.a.m.handler.GpsWebSocketHandler.afterConnectionEstablished - New client connected: 1f091ce8-cc44-6c4d-941a-e0f58cf6f47a
2025-09-14 12:25:08.181 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.fetchGpsData - Received response with 1024860 characters
2025-09-14 12:25:08.266 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.parseGpsData - Parsed 5345 GPS records from JSON
2025-09-14 12:25:08.269 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.getLatestUpdates - Filtered 2040 unique vehicles from 5345 total records
2025-09-14 12:25:08.270 [GpsPolling-1] INFO  [null] c.a.m.handler.GpsWebSocketHandler.broadcastUpdate - Broadcasting 2040 records to 1 clients in batches of 10
2025-09-14 12:25:08.569 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.processData - Broadcasted 2040 records to WebSocket clients
2025-09-14 12:25:08.570 [GpsPolling-1] INFO  [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Polling completed: processed 2040 GPS records
2025-09-14 12:25:10.582 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Starting scheduled GPS polling
2025-09-14 12:25:10.582 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Fetching GPS data from 2025-09-14+12:23:40 to 2025-09-14+12:25:10
2025-09-14 12:25:10.583 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.fetchGpsData - Making request to URL: https://dados.mobilidade.rio/gps/sppo?dataInicial=2025-09-14+12:23:40&dataFinal=2025-09-14+12:25:10
2025-09-14 12:25:21.987 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.fetchGpsData - Received response with 939036 characters
2025-09-14 12:25:22.000 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.parseGpsData - Parsed 4898 GPS records from JSON
2025-09-14 12:25:22.003 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.getLatestUpdates - Filtered 1964 unique vehicles from 4898 total records
2025-09-14 12:25:22.004 [GpsPolling-1] INFO  [null] c.a.m.handler.GpsWebSocketHandler.broadcastUpdate - Broadcasting 1964 records to 1 clients in batches of 10
2025-09-14 12:25:22.077 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.processData - Broadcasted 1964 records to WebSocket clients
2025-09-14 12:25:22.078 [GpsPolling-1] INFO  [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Polling completed: processed 1964 GPS records
2025-09-14 12:25:24.086 [GpsPolling-2] DEBUG [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Starting scheduled GPS polling
2025-09-14 12:25:24.086 [GpsPolling-2] DEBUG [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Fetching GPS data from 2025-09-14+12:23:54 to 2025-09-14+12:25:24
2025-09-14 12:25:24.087 [GpsPolling-2] DEBUG [null] c.a.m.service.GpsPollingService.fetchGpsData - Making request to URL: https://dados.mobilidade.rio/gps/sppo?dataInicial=2025-09-14+12:23:54&dataFinal=2025-09-14+12:25:24
2025-09-14 12:25:35.127 [GpsPolling-2] DEBUG [null] c.a.m.service.GpsPollingService.fetchGpsData - Received response with 914505 characters
2025-09-14 12:25:35.141 [GpsPolling-2] DEBUG [null] c.a.m.service.GpsPollingService.parseGpsData - Parsed 4770 GPS records from JSON
2025-09-14 12:25:35.144 [GpsPolling-2] DEBUG [null] c.a.m.service.GpsPollingService.getLatestUpdates - Filtered 1922 unique vehicles from 4770 total records
2025-09-14 12:25:35.147 [GpsPolling-2] INFO  [null] c.a.m.handler.GpsWebSocketHandler.broadcastUpdate - Broadcasting 1922 records to 1 clients in batches of 10
2025-09-14 12:25:35.222 [GpsPolling-2] DEBUG [null] c.a.m.service.GpsPollingService.processData - Broadcasted 1922 records to WebSocket clients
2025-09-14 12:25:35.222 [GpsPolling-2] INFO  [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Polling completed: processed 1922 GPS records
2025-09-14 12:25:37.227 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Starting scheduled GPS polling
2025-09-14 12:25:37.228 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Fetching GPS data from 2025-09-14+12:24:07 to 2025-09-14+12:25:37
2025-09-14 12:25:37.228 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.fetchGpsData - Making request to URL: https://dados.mobilidade.rio/gps/sppo?dataInicial=2025-09-14+12:24:07&dataFinal=2025-09-14+12:25:37
2025-09-14 12:25:45.736 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.fetchGpsData - Received response with 936211 characters
2025-09-14 12:25:45.743 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.parseGpsData - Parsed 4883 GPS records from JSON
2025-09-14 12:25:45.744 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.getLatestUpdates - Filtered 1938 unique vehicles from 4883 total records
2025-09-14 12:25:45.745 [GpsPolling-1] INFO  [null] c.a.m.handler.GpsWebSocketHandler.broadcastUpdate - Broadcasting 1938 records to 1 clients in batches of 10
2025-09-14 12:25:45.837 [GpsPolling-1] DEBUG [null] c.a.m.service.GpsPollingService.processData - Broadcasted 1938 records to WebSocket clients
2025-09-14 12:25:45.839 [GpsPolling-1] INFO  [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Polling completed: processed 1938 GPS records
2025-09-14 12:25:47.853 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Starting scheduled GPS polling
2025-09-14 12:25:47.854 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Fetching GPS data from 2025-09-14+12:24:17 to 2025-09-14+12:25:47
2025-09-14 12:25:47.854 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.fetchGpsData - Making request to URL: https://dados.mobilidade.rio/gps/sppo?dataInicial=2025-09-14+12:24:17&dataFinal=2025-09-14+12:25:47
2025-09-14 12:25:57.053 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.fetchGpsData - Received response with 863092 characters
2025-09-14 12:25:57.060 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.parseGpsData - Parsed 4502 GPS records from JSON
2025-09-14 12:25:57.061 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.getLatestUpdates - Filtered 1884 unique vehicles from 4502 total records
2025-09-14 12:25:57.061 [GpsPolling-3] INFO  [null] c.a.m.handler.GpsWebSocketHandler.broadcastUpdate - Broadcasting 1884 records to 1 clients in batches of 10
2025-09-14 12:25:57.087 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.processData - Broadcasted 1884 records to WebSocket clients
2025-09-14 12:25:57.088 [GpsPolling-3] INFO  [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Polling completed: processed 1884 GPS records
2025-09-14 12:25:59.091 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Starting scheduled GPS polling
2025-09-14 12:25:59.092 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Fetching GPS data from 2025-09-14+12:24:29 to 2025-09-14+12:25:59
2025-09-14 12:25:59.092 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.fetchGpsData - Making request to URL: https://dados.mobilidade.rio/gps/sppo?dataInicial=2025-09-14+12:24:29&dataFinal=2025-09-14+12:25:59
2025-09-14 12:26:07.569 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.fetchGpsData - Received response with 1007216 characters
2025-09-14 12:26:07.579 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.parseGpsData - Parsed 5253 GPS records from JSON
2025-09-14 12:26:07.582 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.getLatestUpdates - Filtered 1989 unique vehicles from 5253 total records
2025-09-14 12:26:07.582 [GpsPolling-3] INFO  [null] c.a.m.handler.GpsWebSocketHandler.broadcastUpdate - Broadcasting 1989 records to 1 clients in batches of 10
2025-09-14 12:26:07.623 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.processData - Broadcasted 1989 records to WebSocket clients
2025-09-14 12:26:07.624 [GpsPolling-3] INFO  [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Polling completed: processed 1989 GPS records
2025-09-14 12:26:09.636 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Starting scheduled GPS polling
2025-09-14 12:26:09.637 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Fetching GPS data from 2025-09-14+12:24:39 to 2025-09-14+12:26:09
2025-09-14 12:26:09.638 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.fetchGpsData - Making request to URL: https://dados.mobilidade.rio/gps/sppo?dataInicial=2025-09-14+12:24:39&dataFinal=2025-09-14+12:26:09
2025-09-14 12:26:20.777 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.fetchGpsData - Received response with 959745 characters
2025-09-14 12:26:20.783 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.parseGpsData - Parsed 5006 GPS records from JSON
2025-09-14 12:26:20.786 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.getLatestUpdates - Filtered 1948 unique vehicles from 5006 total records
2025-09-14 12:26:20.786 [GpsPolling-3] INFO  [null] c.a.m.handler.GpsWebSocketHandler.broadcastUpdate - Broadcasting 1948 records to 1 clients in batches of 10
2025-09-14 12:26:20.816 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.processData - Broadcasted 1948 records to WebSocket clients
2025-09-14 12:26:20.817 [GpsPolling-3] INFO  [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Polling completed: processed 1948 GPS records
2025-09-14 12:26:22.830 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Starting scheduled GPS polling
2025-09-14 12:26:22.831 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Fetching GPS data from 2025-09-14+12:24:52 to 2025-09-14+12:26:22
2025-09-14 12:26:22.831 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.fetchGpsData - Making request to URL: https://dados.mobilidade.rio/gps/sppo?dataInicial=2025-09-14+12:24:52&dataFinal=2025-09-14+12:26:22
2025-09-14 12:26:26.711 [SpringApplicationShutdownHook] INFO  [null] o.s.b.w.e.tomcat.GracefulShutdown.shutDownGracefully - Commencing graceful shutdown. Waiting for active requests to complete
2025-09-14 12:26:26.724 [tomcat-shutdown] INFO  [null] o.s.b.w.e.tomcat.GracefulShutdown.doShutdown - Graceful shutdown complete
2025-09-14 12:26:30.919 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.fetchGpsData - Received response with 843916 characters
2025-09-14 12:26:30.932 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.parseGpsData - Parsed 4402 GPS records from JSON
2025-09-14 12:26:30.933 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.getLatestUpdates - Filtered 1894 unique vehicles from 4402 total records
2025-09-14 12:26:30.934 [GpsPolling-3] INFO  [null] c.a.m.handler.GpsWebSocketHandler.broadcastUpdate - Broadcasting 1894 records to 1 clients in batches of 10
2025-09-14 12:26:30.936 [GpsPolling-3] ERROR [null] c.a.m.handler.GpsWebSocketHandler.handleTransportError - Transport error in session 1f091ce8-cc44-6c4d-941a-e0f58cf6f47a: java.nio.channels.ClosedChannelException
java.io.IOException: java.nio.channels.ClosedChannelException
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlockInternal(WsRemoteEndpointImplBase.java:326)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlock(WsRemoteEndpointImplBase.java:266)
	at org.apache.tomcat.websocket.WsSession.sendCloseMessage(WsSession.java:792)
	at org.apache.tomcat.websocket.WsSession.doClose(WsSession.java:589)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlockInternal(WsRemoteEndpointImplBase.java:324)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlock(WsRemoteEndpointImplBase.java:266)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlock(WsRemoteEndpointImplBase.java:250)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendPartialString(WsRemoteEndpointImplBase.java:223)
	at org.apache.tomcat.websocket.WsRemoteEndpointBasic.sendText(WsRemoteEndpointBasic.java:48)
	at org.springframework.web.socket.adapter.standard.StandardWebSocketSession.sendTextMessage(StandardWebSocketSession.java:217)
	at org.springframework.web.socket.adapter.AbstractWebSocketSession.sendMessage(AbstractWebSocketSession.java:108)
	at com.azvtech.monitoring_service.handler.GpsWebSocketHandler.sendBatch(GpsWebSocketHandler.java:107)
	at com.azvtech.monitoring_service.handler.GpsWebSocketHandler.broadcastUpdate(GpsWebSocketHandler.java:90)
	at com.azvtech.monitoring_service.service.GpsPollingService.processData(GpsPollingService.java:206)
	at com.azvtech.monitoring_service.service.GpsPollingService.lambda$checkForUpdates$1(GpsPollingService.java:127)
	at io.micrometer.core.instrument.AbstractTimer.record(AbstractTimer.java:250)
	at com.azvtech.monitoring_service.service.GpsPollingService.checkForUpdates(GpsPollingService.java:104)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.runInternal(ScheduledMethodRunnable.java:130)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.lambda$run$2(ScheduledMethodRunnable.java:124)
	at io.micrometer.observation.Observation.observe(Observation.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:124)
	at org.springframework.scheduling.config.Task$OutcomeTrackingRunnable.run(Task.java:85)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)
	at java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:358)
	at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)
	at com.azvtech.monitoring_service.config.MdcConfig.lambda$mdcTaskDecorator$0(MdcConfig.java:64)
	at org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler$DelegatingRunnableScheduledFuture.run(ThreadPoolTaskScheduler.java:508)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.nio.channels.ClosedChannelException: null
	at org.apache.tomcat.util.net.NioChannel$1.write(NioChannel.java:273)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper$NioOperationState.run(NioEndpoint.java:1632)
	at org.apache.tomcat.util.net.SocketWrapperBase$OperationState.start(SocketWrapperBase.java:1051)
	at org.apache.tomcat.util.net.SocketWrapperBase.vectoredOperation(SocketWrapperBase.java:1440)
	at org.apache.tomcat.util.net.SocketWrapperBase.write(SocketWrapperBase.java:1366)
	at org.apache.tomcat.util.net.SocketWrapperBase.write(SocketWrapperBase.java:1337)
	at org.apache.tomcat.websocket.server.WsRemoteEndpointImplServer.doWrite(WsRemoteEndpointImplServer.java:171)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.writeMessagePart(WsRemoteEndpointImplBase.java:521)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlockInternal(WsRemoteEndpointImplBase.java:313)
	... 28 common frames omitted
2025-09-14 12:26:30.945 [GpsPolling-3] ERROR [null] o.s.w.s.h.ExceptionWebSocketHandlerDecorator.tryCloseWithError - Closing session due to exception for StandardWebSocketSession[id=1f091ce8-cc44-6c4d-941a-e0f58cf6f47a, uri=ws://localhost:8080/gps-updates]
java.lang.IllegalStateException: The remote endpoint was in state [TEXT_PARTIAL_WRITING] which is an invalid state for called method
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase$StateMachine.checkState(WsRemoteEndpointImplBase.java:1250)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase$StateMachine.textPartialStart(WsRemoteEndpointImplBase.java:1215)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendPartialString(WsRemoteEndpointImplBase.java:222)
	at org.apache.tomcat.websocket.WsRemoteEndpointBasic.sendText(WsRemoteEndpointBasic.java:48)
	at org.springframework.web.socket.adapter.standard.StandardWebSocketSession.sendTextMessage(StandardWebSocketSession.java:217)
	at org.springframework.web.socket.adapter.AbstractWebSocketSession.sendMessage(AbstractWebSocketSession.java:108)
	at com.azvtech.monitoring_service.handler.GpsWebSocketHandler.handleTransportError(GpsWebSocketHandler.java:65)
	at org.springframework.web.socket.handler.WebSocketHandlerDecorator.handleTransportError(WebSocketHandlerDecorator.java:80)
	at org.springframework.web.socket.handler.LoggingWebSocketHandlerDecorator.handleTransportError(LoggingWebSocketHandlerDecorator.java:64)
	at org.springframework.web.socket.handler.ExceptionWebSocketHandlerDecorator.handleTransportError(ExceptionWebSocketHandlerDecorator.java:68)
	at org.springframework.web.socket.adapter.standard.StandardWebSocketHandlerAdapter.onError(StandardWebSocketHandlerAdapter.java:156)
	at org.apache.tomcat.websocket.WsSession.sendCloseMessage(WsSession.java:807)
	at org.apache.tomcat.websocket.WsSession.doClose(WsSession.java:589)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlockInternal(WsRemoteEndpointImplBase.java:324)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlock(WsRemoteEndpointImplBase.java:266)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlock(WsRemoteEndpointImplBase.java:250)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendPartialString(WsRemoteEndpointImplBase.java:223)
	at org.apache.tomcat.websocket.WsRemoteEndpointBasic.sendText(WsRemoteEndpointBasic.java:48)
	at org.springframework.web.socket.adapter.standard.StandardWebSocketSession.sendTextMessage(StandardWebSocketSession.java:217)
	at org.springframework.web.socket.adapter.AbstractWebSocketSession.sendMessage(AbstractWebSocketSession.java:108)
	at com.azvtech.monitoring_service.handler.GpsWebSocketHandler.sendBatch(GpsWebSocketHandler.java:107)
	at com.azvtech.monitoring_service.handler.GpsWebSocketHandler.broadcastUpdate(GpsWebSocketHandler.java:90)
	at com.azvtech.monitoring_service.service.GpsPollingService.processData(GpsPollingService.java:206)
	at com.azvtech.monitoring_service.service.GpsPollingService.lambda$checkForUpdates$1(GpsPollingService.java:127)
	at io.micrometer.core.instrument.AbstractTimer.record(AbstractTimer.java:250)
	at com.azvtech.monitoring_service.service.GpsPollingService.checkForUpdates(GpsPollingService.java:104)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.runInternal(ScheduledMethodRunnable.java:130)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.lambda$run$2(ScheduledMethodRunnable.java:124)
	at io.micrometer.observation.Observation.observe(Observation.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:124)
	at org.springframework.scheduling.config.Task$OutcomeTrackingRunnable.run(Task.java:85)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)
	at java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:358)
	at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)
	at com.azvtech.monitoring_service.config.MdcConfig.lambda$mdcTaskDecorator$0(MdcConfig.java:64)
	at org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler$DelegatingRunnableScheduledFuture.run(ThreadPoolTaskScheduler.java:508)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-09-14 12:26:30.946 [GpsPolling-3] INFO  [null] c.a.m.handler.GpsWebSocketHandler.afterConnectionClosed - Connection closed: 1f091ce8-cc44-6c4d-941a-e0f58cf6f47a - Reason: null
2025-09-14 12:26:30.946 [GpsPolling-3] ERROR [null] c.a.m.handler.GpsWebSocketHandler.sendBatch - Error sending batch: java.nio.channels.ClosedChannelException
java.io.IOException: java.nio.channels.ClosedChannelException
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlockInternal(WsRemoteEndpointImplBase.java:326)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlock(WsRemoteEndpointImplBase.java:266)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlock(WsRemoteEndpointImplBase.java:250)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendPartialString(WsRemoteEndpointImplBase.java:223)
	at org.apache.tomcat.websocket.WsRemoteEndpointBasic.sendText(WsRemoteEndpointBasic.java:48)
	at org.springframework.web.socket.adapter.standard.StandardWebSocketSession.sendTextMessage(StandardWebSocketSession.java:217)
	at org.springframework.web.socket.adapter.AbstractWebSocketSession.sendMessage(AbstractWebSocketSession.java:108)
	at com.azvtech.monitoring_service.handler.GpsWebSocketHandler.sendBatch(GpsWebSocketHandler.java:107)
	at com.azvtech.monitoring_service.handler.GpsWebSocketHandler.broadcastUpdate(GpsWebSocketHandler.java:90)
	at com.azvtech.monitoring_service.service.GpsPollingService.processData(GpsPollingService.java:206)
	at com.azvtech.monitoring_service.service.GpsPollingService.lambda$checkForUpdates$1(GpsPollingService.java:127)
	at io.micrometer.core.instrument.AbstractTimer.record(AbstractTimer.java:250)
	at com.azvtech.monitoring_service.service.GpsPollingService.checkForUpdates(GpsPollingService.java:104)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.runInternal(ScheduledMethodRunnable.java:130)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.lambda$run$2(ScheduledMethodRunnable.java:124)
	at io.micrometer.observation.Observation.observe(Observation.java:498)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:124)
	at org.springframework.scheduling.config.Task$OutcomeTrackingRunnable.run(Task.java:85)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)
	at java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:358)
	at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)
	at com.azvtech.monitoring_service.config.MdcConfig.lambda$mdcTaskDecorator$0(MdcConfig.java:64)
	at org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler$DelegatingRunnableScheduledFuture.run(ThreadPoolTaskScheduler.java:508)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.nio.channels.ClosedChannelException: null
	at org.apache.tomcat.util.net.NioChannel$1.write(NioChannel.java:273)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper$NioOperationState.run(NioEndpoint.java:1632)
	at org.apache.tomcat.util.net.SocketWrapperBase$OperationState.start(SocketWrapperBase.java:1051)
	at org.apache.tomcat.util.net.SocketWrapperBase.vectoredOperation(SocketWrapperBase.java:1440)
	at org.apache.tomcat.util.net.SocketWrapperBase.write(SocketWrapperBase.java:1366)
	at org.apache.tomcat.util.net.SocketWrapperBase.write(SocketWrapperBase.java:1337)
	at org.apache.tomcat.websocket.server.WsRemoteEndpointImplServer.doWrite(WsRemoteEndpointImplServer.java:171)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.writeMessagePart(WsRemoteEndpointImplBase.java:521)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlockInternal(WsRemoteEndpointImplBase.java:313)
	... 28 common frames omitted
2025-09-14 12:26:30.949 [GpsPolling-3] DEBUG [null] c.a.m.service.GpsPollingService.processData - Broadcasted 1894 records to WebSocket clients
2025-09-14 12:26:30.950 [GpsPolling-3] INFO  [null] c.a.m.service.GpsPollingService.lambda$checkForUpdates$1 - Polling completed: processed 1894 GPS records
